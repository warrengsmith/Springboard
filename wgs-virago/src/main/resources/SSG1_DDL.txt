--association tables

--base tables
DROP TABLE IF EXISTS SSG1_ORDER_DTL;
DROP TABLE IF EXISTS SSG1_ORDER;
DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS BOOK;
--reference tables
DROP TABLE IF EXISTS PYMT_TYPE;

CREATE TABLE PYMT_TYPE(
	PYMT_TYPE_ID INT IDENTITY,
	PYMT_TYPE_NM VARCHAR(25) NOT NULL
);
ALTER TABLE PYMT_TYPE
	ADD CONSTRAINT UNIQ_PT_NAME UNIQUE (PYMT_TYPE_NM);

CREATE TABLE BOOK(
	BOOK_ID     INT IDENTITY,
	TITLE       VARCHAR(50) NOT NULL,
	PRICE       DECIMAL(7,2) NOT NULL,
	DESCRIPTION VARCHAR(255) NOT NULL,
	AUTHOR      VARCHAR(25) NOT NULL
);
ALTER TABLE BOOK
	ADD CONSTRAINT UNIQ_BOOK_TITLE UNIQUE (TITLE);

CREATE TABLE USER(
	USER_ID INT IDENTITY,
	USER_NM VARCHAR(25) NOT NULL
);
ALTER TABLE USER
	ADD CONSTRAINT UNIQ_USER_NAME UNIQUE (USER_NM);

CREATE TABLE SSG1_ORDER(
	ORDER_ID     INT IDENTITY,
	USER_ID      INT NOT NULL,
	PYMT_TYPE_ID INT,
	ORDER_TS     TIMESTAMP NOT NULL
);
ALTER TABLE SSG1_ORDER
	ADD CONSTRAINT UNIQ_ORD_TS UNIQUE (ORDER_TS);
ALTER TABLE SSG1_ORDER
	ADD CONSTRAINT FK_ORDER_USER FOREIGN KEY(USER_ID) REFERENCES USER(USER_ID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;
ALTER TABLE SSG1_ORDER
	ADD CONSTRAINT FK_ORDER_PT FOREIGN KEY(PYMT_TYPE_ID) REFERENCES PYMT_TYPE(PYMT_TYPE_ID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;

CREATE TABLE SSG1_ORDER_DTL(
	ORDER_DTL_ID INT IDENTITY,
	ORDER_ID     INT NOT NULL,
	BOOK_ID      INT NOT NULL
);
ALTER TABLE SSG1_ORDER_DTL
	ADD CONSTRAINT FK_OD_ORDER FOREIGN KEY(ORDER_ID) REFERENCES SSG1_ORDER(ORDER_ID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;
ALTER TABLE SSG1_ORDER_DTL
	ADD CONSTRAINT FK_OD_BOOK FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;